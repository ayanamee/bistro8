pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include tetrislib.lua



function _init()
    pokes()
	--	music(0,1000) 
    init_board()
    init_tetrominoes()
    current_tet = pop_tet(tet_list)
    running = 1

end

function _update()
    player_input()
    if running then
        current_tet:gravity(g_force,y0+h)
    end
end

function _draw()
    cls()
    if running==1 then
        g_frames +=1
        --draw_borders(thickness,7)
        draw_board(false)
        current_tet:draw_ghost()
        current_tet:draw_tet()
        draw_tet_buffer(tet_list)
        print("lines:"..total_lines.."", x_tbf, y_tbf+30, 6)
        if clear_anim.clearing then anim_clear() end
        if g_frames==30 then g_frames=0 end
        draw_borders(thickness,7)
    elseif running==0 then
        print("game over", x_tbf, y_tbf, 7)
        print("lines:"..total_lines.."", x_tbf, y_tbf+10, 7)
        draw_borders(thickness,7)
        draw_board(true)
    end

end

function draw_borders(t,c) --t is thickness, c is color
 	rectfill(bx0,by0,bx0+2*t+w-1,by0+t-1,c) --upper bar
 	rectfill(bx0,by0+t+h,bx0+2*t+w-1,by0+2*t-1+h,c) --lower bar
 	rectfill(bx0,by0+t,bx0+t-1,by0+t+h,c) --left bar
 	rectfill(bx0+t+w,by0+t,bx0+2*t+w-1,by0+t+h,c) --right bar
    --rect(0,0,127,127,7)
end

rotating = 0
rot_counter = 0
function player_input()

    if running == 1 then
        if btn(⬇️) then
            g_force=high_g
            if btnp(⬆️) then
                --up
            end
                
            if btnp(➡️) then current_tet:move_right(4, 40) end
            if btnp(⬅️) then current_tet:move_left(-4,-10) end

            if btnp(4) and rotating == 0 then 
                current_tet:rotate(false)
                rotating = 1
                rot_counter += 1
            elseif btnp(5) and rotating == 0 then 
                current_tet:rotate(true)
                rotating = 1
                rot_counter += 1
            elseif btn(5) or btn(4) then
                rotating = 1
            else
                rotating = 0
            end

        else
            g_force=default_g_force
            if btnp(⬆️) then
                --up
            end
                
            if btnp(➡️) then current_tet:move_right(4, 40) end
            if btnp(⬅️) then current_tet:move_left(-4,-10) end

            if btnp(4) and rotating == 0 then 
                current_tet:rotate(false)
                rotating = 1
                rot_counter += 1
            elseif btnp(5) and rotating == 0 then 
                current_tet:rotate(true)
                rotating = 1
                rot_counter += 1
            elseif btn(5) or btn(4) then
                rotating = 1
            else
                rotating = 0
            end

        end
    else
        if btnp(4) then 
            reset_board()
            init_board()
            init_tetrominoes()
            current_tet = pop_tet(tet_list)
            running = 1
        end
    end
end

function pokes()
    poke(0X5F5C, das) 
    poke(0X5F5D, arr) 
end

__gfx__
000000000000eeee00000000aaaaaaaa0000000011116665000066600000000099990000cccccccccccccccc0000bbbbbbbb0000888888880000000000000000
000000000000eeee00000000aaaaaaaa0000000011116665666566600000000099990000cccccccccccccccc0000bbbbbbbb0000888888880000000000000000
007007000000eeee00000000aaaaaaaa0000000011110555666566600000000099990000cccccccccccccccc0000bbbbbbbb0000888888880000000000000000
000770000000eeee00000000aaaaaaaa0000000011110000666500000000000099990000cccccccccccccccc0000bbbbbbbb0000888888880000000000000000
00077000eeeeeeeeeeee0000aaaaaaaa00000000111111111111000099999999999900000000000000000000bbbbbbbb00000000000088888888000000000000
00700700eeeeeeeeeeee0000aaaaaaaa00000000111111111111055599999999999900000000000000000000bbbbbbbb00000000000088888888000000000000
00000000eeeeeeeeeeee0000aaaaaaaa00000000111111111111055599999999999900000000000000000000bbbbbbbb00000000000088888888000000000000
00000000eeeeeeeeeeee0000aaaaaaaa00000000111111111111055599999999999900000000000000000000bbbbbbbb00000000000088888888000000000000
00000000000000000000000000000000000000005500555055505550000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000006660566655666550000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000006660566655666550000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000006665566605666666000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000005550005550666000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000005666550556660666000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000005666000556660555000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000005666000556660555000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
390000000ca310ea702aa4228a422aa711e21202144181551a1551813516115101740a144061142cb0736b573c3000406010021120311a07120012240322a0622e07232023360533e004021240a1741010512135
0010121f0c1100e14013140181401a1201c1201a11018130171401316017150181201a1101c1101a120181400c15010140131201c1101a12017130151501714018130171201c1001f1001c1001f7001f70000000
0010001f0c7500c750137500c7500c7500c750137500c7500c7500c750137500c7500c7500c750137500c7500c7500c750137500c7500c7500c750137500c7500c7500c750137500c7500c7500c750137500c750
00100000190301e03021000237001e700007001670000700007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100000190201e030250302a03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
382000001885000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
03 01024344

